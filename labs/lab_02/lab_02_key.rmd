---
title: "lab_02"
author: "derek willis"
date: "2024-08-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries and establish settings

```{r}
# Turn off scientific notation
options(scipen=999)

# Load the tidyverse. If you have not installed the tidyverse already, remove the # from the next line and run it first.  
# install.packages('tidyverse')
library(tidyverse)
library(lubridate)
```

## Load Data

Let's keep working with the slice of WinRed contribution data from West Virginia.

```{r}
wv_winred_contribs <- read_rds("data/lab_02.rds")
```

## Examine Data

## Answer questions

**Q1** Create a new column that divides the contribution amounts into the following options - less than \$10, \$10-\$100,  \$101-\$1000, \$1001 and up - and calculates how many contributions are in each group. Describe the distribution of contribution groups in a sentence.

A1. The two largest groups are for contributions of less than \$10, with only 60 contributions that are larger than \$1000.

```{r}
wv_winred_contribs |>
  mutate(
    amount_group = case_when(
      amount < 10 ~ 'under_10',
      amount >= 10 & amount <= 100 ~ '10_100',
      amount > 100 & amount <= 1000 ~ '101_1000',
      amount > 1000 ~ '1001_plus'
    )
  ) |>
  group_by(amount_group) |>
  summarise(
    total = n()
  ) |>
  arrange(desc(total))
```

Q2. Which West Virginia donors made the most contributions of less than \$10? You'll need to use a combination of columns to get unique donors. There's something unusual about the second-most frequent donor; use the [FEC website](https://www.fec.gov/data/receipts/individual-contributions/?two_year_transaction_period=2024&min_date=01%2F01%2F2023&max_date=12%2F31%2F2024) to look into donations from that person's city.

A2. Dr. Noel Corbell of Charles Town made at least 1,492 contributions of less than \$10, nearly 500 more than the next most-frequent donor, John Pam her of Fort Ashby.

```{r}
wv_winred_contribs |>
  filter(amount < 10) |> 
  group_by(last_name, first_name, address_one, city) |>
  summarise(
    total = n()
  ) |>
  arrange(desc(total))
```

Q3. What questions do the results of Q2 raise in your mind? How could you use the data to explore them? 

A3. 

Q4. Which month saw the largest number of contributions? 
A4. May 2024, with 14,639.

```{r}
wv_winred_contribs |>
  mutate(Month = floor_date(date, "month")) |>
  group_by(Month) |>
  summarise(total = n()) |>
  arrange(desc(total))
```

Q5. Write code to find contributions where the amount is less than \$10 _and_ the memo_text contains the word "TRUMP". The way to find a word inside a column is to use the `str_detect()` function inside the filter function, like so: str_detect(column_name, "STRING YOU ARE SEARCHING FOR"). Then keep going and show the total number of contributions for each city, with the largest number of contributions first. Which three cities have the most contributions under \$10? Are there any in the top 10 that stand out? Say why.

A5. The top three cities are Charleston, Martinsburg and Charles Town, which makes sense, population-wise. And there's Fort Ashby, population approximately 1,300 - it's our guy from A2.

```{r}
wv_winred_contribs |>
  filter(amount < 10 & str_detect(memo_text, "TRUMP")) |> 
  group_by(city) |> 
  summarize(contributions = n()) |> 
  arrange(desc(contributions))
```


